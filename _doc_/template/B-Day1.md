# 2024年暑期高级班-Day1课程答疑

> Update: `2024/7/19 21:30`

### Q1. 有没有这样一篇推文或者文章，书，总结了怎么样的数据用怎么样的回归分析。判断方法是通过统计方法内在的含义来区分的。比如fe不能用于研究一直过度投资的数据，因为fe组内残差和是0。

答: 不完全存在任何一本书能够完全囊括所有的回归分析方法，我的码云仓库中放了一些 Textbooks，可以根据自己的基础选择 1-2 本，花 2 个月快速度读一下。[-Link-](https://gitee.com/arlionn/stata/wikis/TextBooks/TextBooks.md)

（回答人：连玉君）


### Q2. 老师好，似无相关模型在文章中的什么场合下会使用呢？似无相关模型放松假设的背后思想是看一个变量对于两组的影响的差异也就是检验两个模型系数的差异，但是似无相关模型的应用目的和场合是什么呢？例如UTD/FT50中有用分组回归看异质性的，也有交叉项说调节效应的，那似无相关模型当前在顶刊中的应用是？

答：似无相关模型最初的应用是在公司截面数据的研究中，我们以华为和小米为例子，华为公司员工收入会收到行业内公司的影响，似无相关模型很好的放松了这一案例背后的假设。具体来说：

- 1.似无相关模型检验组间系数差异，用来判断两组系数是否在统计上有差异。似无相关模型是检验组间系数差异的方法之一，用来判断两组系数是否在统计上有差异。除此之外也可使用交乘项、费舍尔组合检验达到同样的目的。

- 2.是一种对你分组异质性和调节效应的补充说明。你在用分组做异质性或者调节效应的时候，得到的分组系数是8和-2（都显著而且绝对值差异很大），很大可能这种异质性确实存在，但是如果分组系数同正（2.1和2）或者同负（-2.1和-2）且绝对值差异不大，那就不能简单的说明分组的系数有差异或者说谁比谁大，不能直接确认异质性是否存在，要确切的能够在统计上比较，suest得到的结果则是告诉你系数2.1真的比2大，或者2.1和2一样大。

- 3.相关推文

  - 专题：[内生性-因果推断](https://www.lianxh.cn/blogs/19.html)
    - 黄俊凯, 2020, [suest：跨模型比较与广义豪斯曼检验](https://www.lianxh.cn/details/444.html), 连享会 No.444.

  - 专题：[面板数据](https://www.lianxh.cn/blogs/20.html)
    - 连享会, 2020, [Stata面板：suest支持面板数据的似无相关检验](https://www.lianxh.cn/details/366.html), 连享会 No.366.

（回答人：连玉君，卓然）



### Q3. 请问：做异质性分析时候，可以选择交乘项，也可以分组，按照今天讲的，交乘项的假设更加严格，那么是不是可以认为，分组回归是更符合实际情况的，更接近现实？所以做异质性时候是不是优先选择分组回归？同时，由于交乘项假设更严格是不是回归结果更容易显著？还是说分组回归系数差异检验更容易得到显著的结果？

答：整体的理解是正确的

1. 有关分组回归和交互项：
   -（1）你说的交乘项假设更严格是在仅将分组变量与解释变量交乘的情况，此时假设是回归模型中其他所有变量的系数在两组间都是相同的，因此假设更严格；
   -（2）在回归模型中将每一个变量（包括控制变量、固定效应）都与分组变量交乘，即假设了所有变量的系数在两组间是有差别的，本质上等同于分组回归，此时交互项的系数在数值上是等于分组回归下两组回归系数的差，但也意味着模型会更加复杂。
2. 有关结果显著性：
   哪种方法更易得到显著结果，这其实取决于你的数据和研究设计，比如上述不同交互项的设置其实就意味着不同假设。一般来说，如果模型的假设更严格，那么在满足这些假设的情况下，得到的估计结果可能会更精确。然而，如果假设过于严格，而数据并不满足这些假设，那么得到的估计结果可能会有偏误。所以，选择哪种方法，需要根据你的研究问题和数据来决定。

参考推文：

- [连享会](https://www.lianxh.cn/search.html?s=连享会), 2020, [Stata：交乘项该如何使用？-黄河泉老师PPT](https://www.lianxh.cn/details/373.html), 连享会 No.373.
- [陈贤孟](https://www.lianxh.cn/search.html?s=陈贤孟), 2022, [解读交互项及其边际效应](https://www.lianxh.cn/details/1075.html), 连享会 No.1075.

不过，分组回归也会有一些挑战。假设检验，我们用的是 Bootstrap，其实 Bootstrap 也有假设条件：sample 是从 population 中随机抽取的。 

（回答人：连玉君，李萌）



### Q4. 老师好，您介绍Fisher's Permutation Test 时，H0是β1=β2，为什么计算经验p值的分子是算观测值>0.4呢？

答: 本质上bootstrap1000次构造的分布不是严格意义上的规范分布，很多时候存在长尾，不存在双边检验。因此，我们通过bootstrap1000次得到的经验p值是不依赖于分布的，一句话来说，就是观察是否是小概率事件就对了。

（回答人：连玉君，颜国强）



### Q5. 检验模型的R2时候，连老师讲到了LR test，但这个好像不适用于OLS，但我们的代码用的是OLS回归，是不是上课需要才这么做，以后我们要用的话，还是需要MLE估计时候用lrtest？

<img src="https://fig-lianxh.oss-cn-shenzhen.aliyuncs.com/20240719183009.png" style="zoom:67%;" />

答：LR 检验的基础是 Log-likelihood value，例如，在`poisson`, `tobit`，`logit`等模型中应用较多。LR test 通过比较两个模型的对数似然值来检验复杂模型是否显著优于简单模型。在实际应用中，如果使用的是 OLS 回归，通常不会使用 LR test，而是使用 F 检验来比较嵌套模型。

（回答人：连玉君）



### Q6.老师好，面板数据的处理方法中，对核心变量执行组内去心，老师列举了去除个体效应或者年份，如果去除更多的固定效应，例如个体，年份，天数等等，在数据准备时直接在bysort后添加相关变量就行了，对吗？例如：

**答:**

 ```stata
** step1
  bysort id: center $varname, prefix(t) //去除个体固定效应，会生成以t开头的一堆变量
 ** step2
  bysort year: center t*, prefix(x) //在t*等变量的基础上去除时间固定效应
 ```

最终会生成以xt开头的一堆变量，即同时去除了个体固定效应和时间固定效应后的变量。（回答人：连老师，王烨文）



### Q7.老师你好，今天听了分组、交叉项回归的检验，想到了中介效应检验，在江艇（2022）老师提出对中介效应检验三步法的质疑后，翻看国内主流期刊发现对中介效应检验使用了不同的方法：分组法（但许多期刊没有显著性检验）、交叉项法、传统三步法中的第三步（即核心变量X对中介变量D回归法）。请问这三种方法是不是都可行？哪一种更靠谱？其背后的逻辑有什么不同？

答: 有关分组回归、交互项和传统三步法中的第三步：

- 交乘项假设更严格是在仅将分组变量与解释变量交乘的情况，此时假设是回归模型中其他所有变量的系数在两组间都是相同的，因此假设更严格；

- 在回归模型中将每一个变量（包括控制变量、固定效应）都与分组变量交乘，即假设了所有变量的系数在两组间是有差别的，本质上等同于分组回归，此时交互项的系数在数值上是等于分组回归下两组回归系数的差，但也意味着模型会更加复杂。

- 传统三步法的第三步能克服内生性问题，仅做核心变量X对中介变量D的回归，D对Y的因果传导采用文献方式进行论述。

以上三种方法都可以，但是要区分三种方法背后的假设条件的差异，也要因实际的研究背景来判断。

 

### Q8.老师您好，请问用置信区间是否交叠判断组间系数差异，这种方法有参考文献吗？不太理解为什么置信区间没有交叠的话，两组系数就大概率存在差异。在论文中貌似只见过组间系数差异检验来说明的，貌似没见过用图来说明的

答: 我用 CI 重叠只是为了介绍这个问题的背景，并不是用它来做检验的。最终的检验用交叉项或分组差异，比如 `bdiff`，具体可查看推文：

- 专题：[回归分析](https://www.lianxh.cn/blogs/32.html)
  - 连玉君, 2020, [Stata: 如何检验分组回归后的组间系数差异？](https://www.lianxh.cn/details/19.html), 连享会 No.19.
- 专题：[Stata命令](https://www.lianxh.cn/blogs/43.html)
  - 李烨阳, 2023, [Stata：自己动手做组间系数差异检验-bootstrap-bdiff](https://www.lianxh.cn/details/1286.html), 连享会 No.1286.



### Q9. 这个报错是什么情况？

![](https://fig-lianxh.oss-cn-shenzhen.aliyuncs.com/20240719174452.png)

答: 这个报错可能是由于stata里安装的moremata版本过旧，没有定义mm_density函数。

```stata
ssc install moremata, replace
```

重新安装一下moremata命令。

（回答人：李萌）



### Q10. 请助教老师看看这个报错怎么回事？谢谢

![](https://fig-lianxh.oss-cn-shenzhen.aliyuncs.com/20240719174813.png)

答: 
**解决方案1：** 
分两步安装estout包，因为esttab是基于estout的：

 ```stata
** step1
  ssc install estout, replace
 ** step2
  ssc install esttab, replace
 ```

**解决方案2：** 
将课程文件包PX_B_2024b解压后放在person文件夹里，这个包里有课程大多数需要的外部命令。

（回答人：李萌）



### Q11.请教，不太明白 “global PP  "`c(sysdir_personal)'/PX_B_2024b" //课程目录”中，c(sysdir_personal)是什么意思？后面执行cd时，提示不能更换路径？

![ ](https://fig-lianxh.oss-cn-shenzhen.aliyuncs.com/20240719180622.png)

答: 

1.  `c(sysdir_personal)` 是一个特殊的系统函数，它返回你的个人Stata目录（`personal`）的路径；`c(sysdir_personal)'/PX_B_2024b`，通过连接操作/PX_B_2024b来指定子文件夹。
2.  global PP `"c(sysdir_personal)'/PX_B_2024b"` ，这行代码的含义是创建一个名为PP的全局宏，它的值被设置为你的个人Stata目录（`personal`）下的PX_B_2024b文件夹的路径。
3.  cd命令报错的原因是你试图访问的这个路径实际上并不存在，可尝试如下方式解决：
    （1）执行`sysdir`命令查看你的`personal`文件夹所在路径；
    （2）将`personal`文件夹放置stata目录下，或在stata目录下直接创建`personal`文件夹，如`D:/stata/personal `或 `D:/stata17/ado/personal`；
    （3）将课程文件【PX_B_2024b】存放于Stata目录下的`personal`文件夹中。

（回答人：李萌）



### Q12. 老师们，请问使用asreg命令进行滚动回归时，有办法让显著性水平（星号）加到估计系数上吗？如图，我以60为窗口进行滚动回归，但是没办法直接得出是否显著。理想得出的结果是图中_b_x2系数带上显著性星号单独输出。  

![](https://fig-lianxh.oss-cn-shenzhen.aliyuncs.com/20240719180823.png)

答：可以通过每个地方的系数除以标准误得到 t 值（比如x1系数/x1标准误得到t值），然后有t值计算p值（根据` gen p_value = 2 * (1 - t(c(abs(t_value))))` 这个命令用于计算双侧检验的 p 值判断显著性），但我们一般不这么做，原因如下：  

- 1.Fama 和 MacBeth (1973) 提出的两阶段截面回归方法（FM方法）用于检验资产预期收益和因子暴露在截面上是否呈线性关系。asreg 命令在 Stata 中实现了这种方法，特别是其 fmb 选项用于执行 FM 方法的第二阶段截面回归。  
- 2.第一阶段：时序回归。在第一阶段，主要任务是对各个资产进行时序回归，估计其 β 值。这里的关键在于获取 β 值，而不特别关注每个回归的显著性。之所以不需要显著性，是因为这些估计的 β 值主要用于第二阶段的截面回归，而不是直接用于检验假设。  
- 3.标准误的调整。asreg 在第一阶段时序回归中报告的标准误并不是 Newey-West 调整的标准误。Newey-West 调整的标准误主要用于第二阶段截面回归，以应对时间序列数据中的自相关性问题。  可以参考：
  - 彭礼敏, 2021, [Fama–MacBeth 1973 两步法详解-xtfmb-asreg](https://www.lianxh.cn/details/541.html), 连享会 No.541.

（回答人：马朝阳）



### Q13. 请问我用estadd命令增加F test的返回值到结果中，显示报错了，是我的代码有问题吗？

<img src="https://fig-lianxh.oss-cn-shenzhen.aliyuncs.com/20240719181132.png" alt=" " style="zoom:50%;" />

答：在执行`ftest m1 m0`命令之后，已使用数据 $m_1$ 和 $m_0$ 计算 $R^2_{m1} - R^2_{m0}$ ，要是想在执行ftest m1 m0命令之后输出F值，可以先存储一下输出值est store m2，再执行`estadd scalar Fvalue = r(F)`，就可以帮你返回F值。

（回答人：高君）



### Q14. 请问老师们：一般来说实证分析是提出问题，做线性回归，最后稳健性检验，那么假设检验在实证分析中是在哪个步骤，并且有什么作用？

答：一般而言，经济学论文的实证框架包含以下四个部分：

1. 基准回归（X如何影响Y）；
2. 内生性处理与稳健性检验（X对Y的影响是稳健的）；
3. 机制检验（X通过什么渠道影响Y）；
4. 异质性分析（X对Y的影响在什么情况下存在不同）。

  在实证分析的初始阶段，研究者会提出研究假设。例如，研究X是否对Y有显著影响。假设分为原假设（H0）和备择假设（H1）。原假设通常表示没有关系，而备择假设则表示存在关系。研究者通过计算p值（显著性水平），与预设的显著性水平（如0.05）进行比较，判断是否拒绝原假设。如果p值小于显著性水平，则拒绝原假设，说明X对Y存在显著影响。

（回答人：王烨文）



### Q15. 老师请问工具变量和调节变量的关系是怎么样的？

答：工具变量（Instrumental Variable, IV）和调节变量（Moderator Variable）是实证分析中常用的两个概念，二者在研究设计和数据分析中的作用和应用场景有所不同。

### 1. 工具变量

**定义**：工具变量是一种在存在内生性问题时用于解决内生性偏差的变量。内生性问题通常由反向因果关系、解释变量与误差项的相关性或遗漏变量偏差引起。

**特点**：工具变量需要满足两个条件：

1. **相关性**：工具变量与内生解释变量高度相关。
2. **排他性**：工具变量与误差项不相关。

**作用**：工具变量用于提供一种外部冲击，以识别解释变量对被解释变量的因果效应。

**应用场景**：在经济学和计量经济学中，当存在内生性问题时，研究者会使用两阶段最小二乘法（2SLS）进行估计。第一阶段，工具变量用于预测内生解释变量；第二阶段，使用预测值进行回归分析。

### 2. 调节变量

**定义**：调节变量是指影响解释变量与被解释变量之间关系强度或方向的变量。它用于探索一个关系在不同条件下是否会发生变化。

**特点**：

- 调节变量本身不是主要的解释变量，而是用于探讨主要解释变量与被解释变量之间的关系在不同条件下如何变化。
- 调节变量与解释变量和被解释变量之间的交互项通常被引入回归模型中。

**作用**：调节变量用于检验和解释不同条件下的效应异质性，揭示解释变量和被解释变量关系的动态特性。

**应用场景**：在回归分析中，研究者通常通过引入交互项来检验调节效应。例如，可以通过构建解释变量和调节变量的交互项来探讨调节效应。

### 关系与区别

**共同点**：工具变量和调节变量都用于探讨和解释模型中的复杂关系和因果效应。

**区别**：

- 工具变量主要用于解决内生性问题，确保估计结果的有效性和一致性。
- 调节变量主要用于检验和解释不同条件下的效应异质性，探索关系的动态特性。

通过理解工具变量和调节变量的作用和应用场景，研究者可以更好地设计实证研究和解释结果，从而提高研究的科学性和严谨性。

（回答人：颜国强）